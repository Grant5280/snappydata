hydra.Prms-testRequirement = "Test to verify ,when the cluster is started in recovery mode with RLS enabled ,it is started in read only mode.";
hydra.Prms-testDescription = "The test starts a normal cluster ,creates tables and populates it.
 Then the cluster is stopped and restarted in recovery mode.After the cluster is started in recovery mode, dml ops are executed,
  validation is done ,such that only SELECT operation should be permitted.";

INCLUDE $JTESTS/io/snappydata/hydra/security/startSnappyCluster.conf;

INITTASK    taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_executeSQLScripts
            io.snappydata.hydra.cluster.SnappyPrms-sqlScriptNames = create_and_load_synthetic_patients.sql
            io.snappydata.hydra.security.SnappySecurityPrms-userName = gemfire1
            io.snappydata.hydra.security.SnappySecurityPrms-passWord = gemfire1
            io.snappydata.hydra.cluster.SnappyPrms-dataLocation = ${dataFilesLocation}
            threadGroups = snappyThreads;

// Create views,UDF/UDAF

//Stop the original cluster
INCLUDE $JTESTS/io/snappydata/hydra/security/stopSnappyCluster.conf;

//Start the cluster in recovery mode.
INITTASK   taskClass   = io.snappydata.hydra.dataExtractorTool.DataExtractorToolTest taskMethod  = HydraTask_startClusterInRecoveryMode
           io.snappydata.hydra.cdcConnector.SnappyCDCPrms-snappyFileLoc = ${snappyBinPath}
           io.snappydata.hydra.security.SnappySecurityPrms-isSecurity = true
           threadGroups = snappyThreads;

//Execute DML query using jdbc connection and validate
INITTASK   taskClass   = io.snappydata.hydra.dataExtractorTool.DataExtractorToolTest taskMethod  = HydraTask_executeQuery
           io.snappydata.hydra.security.SnappySecurityPrms-dataLocation = ${dmlFileLocation}
           io.snappydata.hydra.security.SnappySecurityPrms-expectedExcptCnt = ${expectedExcptCnt}
           io.snappydata.hydra.security.SnappySecurityPrms-unExpectedExcptCnt = 0
           threadGroups = snappyThreads;

//Execute DDL query using jdbc connection and validate
INITTASK   taskClass   = io.snappydata.hydra.dataExtractorTool.DataExtractorToolTest taskMethod  = HydraTask_executeQuery
           io.snappydata.hydra.security.SnappySecurityPrms-dataLocation = ${ddlFileLocation}
           io.snappydata.hydra.security.SnappySecurityPrms-expectedExcptCnt = ${expectedExcptCnt} ////decide the cnt after running them manually
           io.snappydata.hydra.security.SnappySecurityPrms-unExpectedExcptCnt = 0
           threadGroups = snappyThreads;

//Execute query using snappyJob and validate
/*INITTASK    taskClass = io.snappydata.hydra.cluster.SnappyTest taskMethod = HydraTask_executeSnappyJobUsingJobScript
            io.snappydata.hydra.cluster.SnappyPrms-jobClassNames = io.snappydata.hydra.dataExtractorTool.CreateAndLoadTablesSnappyJob
            io.snappydata.hydra.cluster.SnappyPrms-appPropsForJobServer = " dataFilesLocation=${dataFilesLocation} --conf queryFile=${dataLocation} --conf expectedCntWithGrant=${expectedExcptCnt} --conf unExpectedCntWithGrant=0 "
            io.snappydata.hydra.cluster.SnappyPrms-userAppJar = snappydata-store-scala-tests*tests.jar
            threadGroups = snappyThreads;*/


io.snappydata.hydra.cluster.SnappyPrms-userAppJar = snappydata-store-scala-tests*tests.jar;
io.snappydata.hydra.cluster.SnappyPrms-shufflePartitions = 6;
io.snappydata.hydra.cluster.SnappyPrms-serverMemory = 4g;
io.snappydata.hydra.cluster.SnappyPrms-locatorLauncherProps = " -J-Dsnappydata.enable-rls=true -auth-provider=LDAP -J-Dsnappydata.auth-ldap-server=ldap://localhost:389/ -user=gemfire1 -password=gemfire1 -J-Dgemfirexd.auth-ldap-search-base=cn=sales-group,ou=sales,dc=example,dc=com -J-Dgemfirexd.auth-ldap-search-dn=cn=admin,dc=example,dc=com -J-Dgemfirexd.auth-ldap-search-pw=admin123";
io.snappydata.hydra.cluster.SnappyPrms-serverLauncherProps = " -J-Dsnappydata.enable-rls=true -auth-provider=LDAP -J-Dsnappydata.auth-ldap-server=ldap://localhost:389/ -user=gemfire1 -password=gemfire1 -J-Dgemfirexd.auth-ldap-search-base=cn=sales-group,ou=sales,dc=example,dc=com -J-Dgemfirexd.auth-ldap-search-dn=cn=admin,dc=example,dc=com -J-Dgemfirexd.auth-ldap-search-pw=admin123";
io.snappydata.hydra.cluster.SnappyPrms-leaderLauncherProps = " -J-Dsnappydata.enable-rls=true -auth-provider=LDAP -J-Dsnappydata.auth-ldap-server=ldap://localhost:389/ -user=gemfire1 -password=gemfire1 -J-Dgemfirexd.auth-ldap-search-base=cn=sales-group,ou=sales,dc=example,dc=com -J-Dgemfirexd.auth-ldap-search-dn=cn=admin,dc=example,dc=com -J-Dgemfirexd.auth-ldap-search-pw=admin123";

